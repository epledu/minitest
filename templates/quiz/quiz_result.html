{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="text-align: center;">
    <p style="color: var(--main-color); margin-bottom: 5px;">당신의 분석 결과는?</p>
    <h2 style="font-size: 28px; margin-top: 0;">{{ result.title }}</h2>


    {% if quiz.slug == "dopamine-test" %}
    <img src="{% static 'img/dopamin_answer.png' %}" style="width: 100%; border-radius: 20px; margin: 20px 0;">
    {% elif quiz.slug == "micro-spending" %}
    <img src="{% static 'img/dopamin_answer1.png' %}" style="width: 100%; border-radius: 20px; margin: 20px 0;">
    {% elif result.share_image_url %}
    <img src="{{ result.share_image_url }}" style="width: 100%; border-radius: 20px; margin: 20px 0;">
    {% endif %}

    <div style="background: #1a1a1a; padding: 20px; border-radius: 15px; text-align: left; line-height: 1.6;">
        <p style="font-weight: bold; color: var(--main-color);">"{{ result.one_liner }}"</p>
        <p>{{ result.description }}</p>

        <div style="background: #000; padding: 15px; border-left: 4px solid var(--main-color); margin: 20px 0;">
            <p style="margin: 0; font-size: 14px;">🛠 오늘의 디톡스 미션:</p>
            <p style="margin: 5px 0 0 0;">{{ result.mission }}</p>
        </div>
    </div>

    <div class="ad-container">
        <ins class="adsbygoogle" style="display:block" data-ad-format="fluid"></ins>
    </div>

    <button onclick="shareKakao()" data-share-image="{% if quiz.slug == 'dopamine-test' %}{% static 'img/kakao_share.png' %}{% elif quiz.slug == 'micro-spending' %}{% static 'img/dopamin_answer1.png' %}{% else %}{{ kakao_share_image_url }}{% endif %}" style="width: 100%; padding: 15px; background: #fee500; color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        카카오톡으로 결과 공유하기 💬
    </button>

    <a href="{% url 'quiz:quiz_list' %}" style="display: block; text-decoration: none; color: #aaa; font-size: 14px; margin-top: 20px;">다른 테스트도 해보기 ➔</a>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function shareKakao() {
        if (!window.Kakao || !Kakao.isInitialized()) {
            alert("카카오 SDK 초기화가 필요합니다. KAKAO_JS_KEY를 확인해 주세요.");
            return;
        }
        const button = document.querySelector("[data-share-image]");
        const shareImage = button ? button.getAttribute("data-share-image") : "";

        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: '{{ result.title }}',
                description: '{{ result.one_liner }}',
                imageUrl: shareImage || '{{ result.share_image_url }}' || '{{ kakao_share_image_url }}',
                link: {
                    mobileWebUrl: window.location.href,
                    webUrl: window.location.href,
                },
            },
            buttons: [
                {
                    title: '테스트 하러가기',
                    link: {
                        mobileWebUrl: window.location.origin,
                        webUrl: window.location.origin,
                    },
                },
            ],
        });
    }
</script>
{% endblock %}
